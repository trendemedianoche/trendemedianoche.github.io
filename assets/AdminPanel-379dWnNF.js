import{r as d,j as e,s as g}from"./index-DmwBOvo4.js";import{g as E,u as _,c as I,d as M}from"./newsService-D69k9KXq.js";import{g as q,u as b,c as A,d as D}from"./extraNewsService-B_9e_VTT.js";import{a as F,d as P,u as S,r as $}from"./donationService-KK70MC_t.js";import{m as L,d as B,g as U}from"./chatService-BFv-9loB.js";const R="/assets/visible-CJkPjRH8.png",G="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'%3e%3c!--%20Ojo%20exterior%20--%3e%3cpath%20fill='currentColor'%20d='M256%2096C132%2096%2040%20256%2040%20256s92%20160%20216%20160%20216-160%20216-160S380%2096%20256%2096z'%3e%3c/path%3e%3c!--%20Iris%20--%3e%3ccircle%20cx='256'%20cy='256'%20r='96'%20fill='%23ffffff'%3e%3c/circle%3e%3c!--%20Pupila%20--%3e%3ccircle%20cx='256'%20cy='256'%20r='48'%20fill='currentColor'%3e%3c/circle%3e%3c/svg%3e",k="trendemedianoche_assets";function H(){const[s,h]=d.useState([]),[o,l]=d.useState(null),[m,x]=d.useState(""),[r,a]=d.useState(!1),t=d.useRef(null),p=n=>{const j=n.split("/").pop();return j?j.length>18?`${j.slice(0,10)}â€¦${j.slice(-6)}`:j:""},u=async()=>{a(!0);const{data:n,error:j}=await g.from("gallery_images").select("*").order("position",{ascending:!0});if(j){x("Error cargando imÃ¡genes"),a(!1);return}const f=await Promise.all(n.map(async w=>{const{data:N}=await g.storage.from(k).createSignedUrl(w.path,3600);return N?{...w,url:N.signedUrl}:null}));h(f.filter(Boolean)),a(!1)};d.useEffect(()=>{u()},[]);const i=()=>{l(null),x(""),t.current&&(t.current.value="")},y=async()=>{if(!o){x("Selecciona una imagen");return}a(!0);const n=`images/${Date.now()}-${o.name}`,{error:j}=await g.storage.from(k).upload(n,o);if(j){x(j.message),a(!1);return}const f=Math.max(0,...s.map(w=>w.position||0));await g.from("gallery_images").insert({path:n,position:f+1,active:!0}),i(),x("Imagen subida correctamente"),a(!1),u()},C=async n=>{a(!0),await g.from("gallery_images").update({active:!n.active}).eq("id",n.id),u()},c=async(n,j)=>{const f=n+j;if(f<0||f>=s.length)return;const w=s[n],N=s[f];a(!0),await g.from("gallery_images").update({position:-1}).eq("id",w.id),await g.from("gallery_images").update({position:w.position}).eq("id",N.id),await g.from("gallery_images").update({position:N.position}).eq("id",w.id),u()},v=async n=>{window.confirm("Â¿Eliminar imagen definitivamente?")&&(a(!0),await g.storage.from(k).remove([n.path]),await g.from("gallery_images").delete().eq("id",n.id),x("Imagen eliminada"),u())};return e.jsxs("div",{className:"photo-admin",children:[e.jsxs("header",{className:"admin-header",children:[e.jsx("h2",{children:"GalerÃ­a Â· AdministraciÃ³n"}),e.jsx("p",{children:"Gestiona imÃ¡genes visibles en el sitio"})]}),e.jsxs("div",{className:"upload-panel",children:[e.jsxs("label",{className:"upload-box",children:[e.jsx("input",{type:"file",hidden:!0,ref:t,disabled:r,onChange:n=>l(n.target.files[0])}),e.jsx("span",{children:"âž• Seleccionar imagen"})]}),e.jsx("button",{className:"primary-btn",onClick:y,disabled:!o||r,children:r?"Subiendoâ€¦":"Subir a galerÃ­a"}),o&&!r&&e.jsxs("div",{className:"file-hint",children:[e.jsxs("span",{children:["ðŸ“Ž Archivo seleccionado: ",e.jsx("strong",{children:p(o.name)})]}),e.jsx("button",{type:"button",className:"cancel-file-btn",onClick:i,title:"Quitar imagen",children:"âŒ"})]})]}),m&&e.jsx("p",{className:"message",children:m}),r&&e.jsx("p",{className:"message",children:"Procesandoâ€¦"}),e.jsx("div",{className:"photo-admin-grid",children:s.map((n,j)=>e.jsxs("div",{className:`photo-card ${n.active?"":"inactive"}`,children:[e.jsxs("div",{className:"photo-preview",children:[n.url&&e.jsx("img",{src:n.url,alt:n.path}),!n.active&&e.jsx("span",{className:"badge",children:"Inactiva"})]}),e.jsxs("div",{className:"photo-info",children:[e.jsx("strong",{title:n.path,children:p(n.path)}),e.jsx("span",{children:new Date(n.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"photo-actions",children:[e.jsx("button",{onClick:()=>c(j,-1),disabled:r,children:"â¬…"}),e.jsx("button",{onClick:()=>c(j,1),disabled:r,children:"âž¡"}),e.jsx("button",{className:"toggle",onClick:()=>C(n),disabled:r,children:n.active?e.jsx("img",{src:R,alt:"Visible",className:"img"}):e.jsx("img",{src:G,alt:"No visible",className:"img"})}),e.jsx("button",{className:"danger",onClick:()=>v(n),children:"âŒ"})]})]},n.id))})]})}function O({activeTab:s,setActiveTab:h,role:o}){const l=async()=>{await g.auth.signOut(),window.location.href="/login"};return e.jsxs("header",{className:"admin-header",children:[e.jsxs("div",{className:"admin-left",children:[e.jsx("h1",{children:"Admin Â· Tren de Medianoche"}),e.jsxs("nav",{children:[e.jsx("button",{className:s==="chat"?"active":"",onClick:()=>h("chat"),children:"Chat"}),e.jsx("button",{className:s==="photos"?"active":"",onClick:()=>h("photos"),children:"Fotos"}),e.jsx("button",{className:s==="sections"?"active":"",onClick:()=>h("sections"),children:"Secciones"}),e.jsx("button",{className:s==="news"?"active":"",onClick:()=>h("news"),children:"Noticias"}),e.jsx("button",{className:s==="extra-news"?"active":"",onClick:()=>h("extra-news"),children:"Extra"}),e.jsx("button",{className:s==="donation"?"active":"",onClick:()=>h("donation"),children:"Donaciones"}),o==="admin"&&e.jsx("button",{className:s==="users"?"active":"",onClick:()=>h("users"),children:"Usuarios"})]})]}),e.jsx("div",{className:"admin-right",children:e.jsx("button",{className:"logout-btn",onClick:l,children:"Cerrar sesiÃ³n"})})]})}function V(){const[s,h]=d.useState([]),[o,l]=d.useState(null),[m,x]=d.useState({title:"",content:"",date:""}),r=async()=>{const i=await E();h(i)};d.useEffect(()=>{r()},[]);const a=()=>{l(null),x({title:"",content:"",date:""})},t=async i=>{i.preventDefault(),o?await _(o.id,m):await I(m),a(),r()},p=i=>{l(i),x({title:i.title,content:i.content,date:i.date})},u=async i=>{window.confirm("Â¿Eliminar noticia?")&&(await M(i),r())};return e.jsxs("div",{className:"news-admin",children:[e.jsxs("header",{className:"admin-header",children:[e.jsx("h2",{children:"Noticias"}),e.jsx("p",{children:"Crear, editar y eliminar entradas"})]}),e.jsxs("div",{className:"news-admin-layout",children:[e.jsxs("div",{className:"news-card",children:[e.jsx("h3",{children:o?"Editar noticia":"Crear nueva noticia"}),e.jsxs("form",{className:"news-form",onSubmit:t,children:[e.jsxs("label",{children:["TÃ­tulo",e.jsx("input",{type:"text",placeholder:"TÃ­tulo de la noticia",value:m.title,onChange:i=>x({...m,title:i.target.value}),required:!0})]}),e.jsxs("label",{children:["Contenido",e.jsx("textarea",{rows:5,placeholder:"Contenido de la noticia",value:m.content,onChange:i=>x({...m,content:i.target.value}),required:!0})]}),e.jsxs("label",{children:["Fecha",e.jsx("input",{type:"date",value:m.date,onChange:i=>x({...m,date:i.target.value}),required:!0})]}),e.jsxs("div",{className:"news-form-actions",children:[e.jsx("button",{type:"submit",className:"primary-btn",children:o?"Guardar cambios":"Crear noticia"}),o&&e.jsx("button",{type:"button",className:"secondary-btn",onClick:a,children:"Cancelar ediciÃ³n"})]})]})]}),e.jsxs("div",{className:"news-card",children:[e.jsx("h3",{children:"Noticias existentes"}),e.jsxs("div",{className:"news-admin-list",children:[s.map(i=>e.jsxs("div",{className:"news-item-row",children:[e.jsxs("div",{className:"news-item-info",children:[e.jsx("strong",{children:i.title}),e.jsx("span",{children:i.date})]}),e.jsxs("div",{className:"news-item-actions",children:[e.jsx("button",{onClick:()=>p(i),title:"Editar",children:"âœï¸"}),e.jsx("button",{onClick:()=>u(i.id),title:"Eliminar",children:"ðŸ—‘"})]})]},i.id)),s.length===0&&e.jsx("p",{className:"empty",children:"No hay noticias creadas"})]})]})]})]})}function z(){const[s,h]=d.useState([]),[o,l]=d.useState(null),[m,x]=d.useState(!1),[r,a]=d.useState({icon:"",content:"",active:!0}),t=async()=>{const c=await q();h(c)};d.useEffect(()=>{t()},[]);const p=async c=>{if(c.preventDefault(),x(!0),o)await b(o.id,r);else{const v=s.length>0?Math.max(...s.map(n=>n.position))+1:1;await A({...r,position:v})}a({icon:"",content:"",active:!0}),l(null),x(!1),t()},u=c=>{l(c),a({icon:c.icon,content:c.content,active:c.active})},i=async c=>{window.confirm("Â¿Eliminar Extra News?")&&(await D(c),t())},y=async c=>{await b(c.id,{active:!c.active}),t()},C=async(c,v)=>{const n=c+v;if(n<0||n>=s.length)return;const j=s[c],f=s[n];await b(j.id,{position:-1}),await b(f.id,{position:j.position}),await b(j.id,{position:f.position}),t()};return e.jsxs("div",{className:"extra-news-admin",children:[e.jsx("h2",{children:"Extra News Â· Barra superior"}),e.jsxs("form",{className:"news-form",onSubmit:p,children:[e.jsx("input",{type:"text",placeholder:"Icono (ðŸ”¥ ðŸ“… âš¡)",value:r.icon,onChange:c=>a({...r,icon:c.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Contenido (HTML permitido)",value:r.content,onChange:c=>a({...r,content:c.target.value}),required:!0}),e.jsxs("button",{className:"primary-btn",type:"submit",disabled:m,children:[o?"Actualizar":"Crear"," Extra News"]}),o&&e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>{l(null),a({icon:"",content:"",active:!0})},children:"Cancelar ediciÃ³n"})]}),e.jsx("div",{className:"news-admin-list",children:s.map((c,v)=>e.jsxs("div",{className:`news-admin-item ${c.active?"":"inactive"}`,children:[e.jsxs("div",{className:"content",children:[e.jsx("strong",{children:c.icon}),e.jsx("span",{dangerouslySetInnerHTML:{__html:c.content}})]}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{onClick:()=>C(v,-1),title:"Subir",children:"â¬†"}),e.jsx("button",{onClick:()=>C(v,1),title:"Bajar",children:"â¬‡"}),e.jsx("button",{onClick:()=>y(c),title:c.active?"Ocultar":"Mostrar",children:c.active?"ðŸ‘":"ðŸš«"}),e.jsx("button",{onClick:()=>u(c),title:"Editar",children:"âœï¸"}),e.jsx("button",{onClick:()=>i(c.id),title:"Eliminar",children:"ðŸ—‘"})]})]},c.id))})]})}function J(){const[s,h]=d.useState([]),[o,l]=d.useState(null);d.useEffect(()=>{m()},[]);const m=async()=>{const t=await F();h(t.fields),l(t.methodId)},x=async t=>{await S(t.id,{visible:!t.visible}),m()},r=async(t,p)=>{await S(t,{field_value:p})},a=async(t,p)=>{const u=[...s],i=t+p;i<0||i>=u.length||([u[t],u[i]]=[u[i],u[t]],h(u),await $(u))};return e.jsxs("div",{className:"admin-module",children:[e.jsx("h2",{children:"Datos de DonaciÃ³n"}),s.map((t,p)=>e.jsxs("div",{className:"donation-admin-row",children:[e.jsx("input",{value:t.field_value,onChange:u=>r(t.id,u.target.value)}),e.jsx("span",{children:t.field_key}),e.jsx("button",{onClick:()=>x(t),children:t.visible?"ðŸ‘":"ðŸš«"}),e.jsx("button",{onClick:()=>a(p,-1),children:"â¬†"}),e.jsx("button",{onClick:()=>a(p,1),children:"â¬‡"}),e.jsx("button",{onClick:()=>P(t.id),children:"ðŸ—‘"})]},t.id))]})}function K(){const[s,h]=d.useState([]),[o,l]=d.useState(!1),m=async()=>{l(!0);const{data:a,error:t}=await g.from("site_sections").select("*").order("position");if(t){console.error("Error loading sections:",t),l(!1);return}h(a),l(!1)};d.useEffect(()=>{m()},[]);const x=async a=>{await g.from("site_sections").update({active:!a.active}).eq("id",a.id),m()},r=async(a,t)=>{const p=a+t;if(p<0||p>=s.length)return;const u=s[a],i=s[p];await g.from("site_sections").update({position:-1}).eq("id",u.id),await g.from("site_sections").update({position:u.position}).eq("id",i.id),await g.from("site_sections").update({position:i.position}).eq("id",u.id),m()};return e.jsxs("div",{className:"section-admin",children:[e.jsx("h2",{children:"GestiÃ³n de secciones"}),s.map((a,t)=>e.jsxs("div",{className:`section-row ${a.active?"":"inactive"}`,children:[e.jsxs("div",{className:"section-info",children:[e.jsx("strong",{children:a.label}),e.jsx("span",{children:a.key})]}),e.jsxs("div",{className:"section-actions",children:[e.jsx("button",{onClick:()=>r(t,-1),disabled:o,title:"Subir",children:"â¬†"}),e.jsx("button",{onClick:()=>r(t,1),disabled:o,title:"Bajar",children:"â¬‡"}),e.jsx("button",{className:"toggle",onClick:()=>x(a),disabled:o,children:a.active?"ðŸ‘":"ðŸš«"})]})]},a.id))]})}function Q(){const[s,h]=d.useState([]),o=async()=>{const l=await U();h(l)};return d.useEffect(()=>{o()},[]),e.jsxs("div",{className:"chat-admin",children:[e.jsx("h2",{children:"Mensajes recibidos"}),s.length===0&&e.jsx("p",{children:"No hay mensajes"}),s.map(l=>e.jsxs("div",{className:`chat-card ${l.read?"read":""}`,children:[e.jsx("strong",{children:l.name}),e.jsx("span",{children:l.email}),e.jsx("p",{children:l.message}),e.jsxs("div",{className:"chat-actions",children:[!l.read&&e.jsx("button",{onClick:()=>{L(l.id),o()},children:"âœ” Marcar leÃ­do"}),e.jsx("button",{className:"danger",onClick:()=>{confirm("Â¿Eliminar mensaje?")&&(B(l.id),o())},children:"ðŸ—‘ Eliminar"})]})]},l.id))]})}function ee(){const[s,h]=d.useState("chat");return e.jsxs("div",{className:"admin-layout",children:[e.jsx(O,{activeTab:s,setActiveTab:h}),e.jsxs("main",{className:"admin-content",children:[s==="chat"&&e.jsx(Q,{}),s==="photos"&&e.jsx(H,{}),s==="sections"&&e.jsx(K,{}),s==="news"&&e.jsx(V,{}),s==="extra-news"&&e.jsx(z,{}),s==="donation"&&e.jsx(J,{})]})]})}export{ee as default};
