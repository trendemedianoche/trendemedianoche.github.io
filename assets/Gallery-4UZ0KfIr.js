import{s as h,r,j as n}from"./index-BdLs0ZPF.js";const y="trendemedianoche_assets";async function j(){const{data:e,error:d}=await h.from("gallery_images").select("*").eq("active",!0).order("position",{ascending:!0});return d?(console.error(d),[]):(await Promise.all(e.map(async l=>{const{data:c,error:g}=await h.storage.from(y).createSignedUrl(l.path,3600);return g?(console.error(g),null):{...l,url:c.signedUrl}}))).filter(Boolean)}function C(){const[e,d]=r.useState([]),[t,l]=r.useState(null),[c,g]=r.useState(0),[v,m]=r.useState(!1),[p,N]=r.useState(null);r.useEffect(()=>{j().then(d)},[]);const u=()=>{l(null)},I=()=>{if(!t)return;const o=(e.findIndex(i=>i.id===t.id)+1)%e.length;l(e[o])},f=()=>{if(!t)return;const o=(e.findIndex(i=>i.id===t.id)-1+e.length)%e.length;l(e[o])},s=e.length?e[c%e.length]:null;return r.useEffect(()=>{if(!e.length||!s)return;const a=new Image;return a.src=s.url,a.onload=()=>m(!0),()=>{m(!1)}},[s,e.length]),r.useEffect(()=>{if(!e.length)return;const a=setInterval(()=>{const o=(c+1)%e.length,i=e[o],x=new Image;x.src=i.url,x.onload=()=>{g(o)}},3e3);return()=>clearInterval(a)},[e.length,c]),n.jsxs(n.Fragment,{children:[n.jsx("section",{id:"media",className:"gallery-section",children:s&&n.jsx("div",{className:"media-cta-container",style:{backgroundImage:`url(${s.url})`},onClick:()=>l(s),role:"button","aria-label":"Ver foto",children:n.jsx("div",{className:"media-cta-overlay",onClick:()=>l(s)})})}),t&&n.jsx("div",{className:"gallery-modal",onClick:u,children:n.jsxs("div",{className:"gallery-modal-content",onClick:a=>a.stopPropagation(),children:[n.jsx("button",{className:"gallery-modal-close",onClick:u,children:"✕"}),n.jsx("div",{className:"gallery-modal-image-container",children:n.jsx("img",{src:t.url,alt:t.alt||"Tren de Medianoche",className:"gallery-modal-image"})}),n.jsxs("div",{className:"gallery-modal-controls",children:[n.jsx("button",{className:"gallery-nav-btn gallery-nav-prev",onClick:f,title:"Imagen anterior",children:"◀"}),n.jsxs("div",{className:"gallery-modal-info",children:[n.jsx("span",{children:e.findIndex(a=>a.id===t.id)+1}),n.jsx("span",{children:"/"}),n.jsx("span",{children:e.length})]}),n.jsx("button",{className:"gallery-nav-btn gallery-nav-next",onClick:I,title:"Siguiente imagen",children:"▶"})]})]})})]})}export{C as default};
