import{r as n,j as e}from"./index-Qq9GdPPQ.js";import{h as S,i as N,j as y,k as w}from"./commentsService-CtRxNrcg.js";function k(){const[h,g]=n.useState([]),[s,u]=n.useState(null),[i,x]=n.useState([]),[b,j]=n.useState({}),[a,c]=n.useState({author_name:"",author_email:"",content:""}),[m,r]=n.useState("");n.useEffect(()=>{v()},[]);const v=async()=>{const t=await S();g(t);const o={};for(const l of t)o[l.id]=await N(l.id);j(o)},p=async t=>{const o=await w(t);x(o)},_=t=>{u(t),p(t.id),c({author_name:"",author_email:"",content:""}),r("")},C=()=>{u(null),x([]),c({author_name:"",author_email:"",content:""}),r("")},f=async t=>{if(t.preventDefault(),!a.author_name||!a.content){r("Por favor completa todos los campos obligatorios");return}try{await y({post_id:s.id,...a}),r("Â¡Comentario publicado correctamente!"),c({author_name:"",author_email:"",content:""}),await p(s.id);const o=await N(s.id);j(l=>({...l,[s.id]:o}))}catch(o){r("Error al enviar el comentario. Intenta de nuevo."),console.error(o)}},d=t=>new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"});return s?e.jsx("section",{id:"blog",className:"blog-section",children:e.jsxs("div",{className:"blog-container",children:[e.jsx("button",{className:"back-button",onClick:C,children:"â† Volver al Blog"}),e.jsxs("article",{className:"blog-post-detail",children:[e.jsx("h1",{className:"post-title",children:s.title}),e.jsxs("div",{className:"post-meta",children:[e.jsxs("span",{className:"post-author",children:["Por ",s.author]}),e.jsx("span",{className:"post-date",children:d(s.created_at)})]}),e.jsx("div",{className:"post-content",dangerouslySetInnerHTML:{__html:s.content}})]}),e.jsxs("div",{className:"comments-section",children:[e.jsxs("h2",{children:["Comentarios (",i.length,")"]}),e.jsx("div",{className:"comments-list",children:i.length===0?e.jsx("p",{className:"no-comments",children:"No hay comentarios aÃºn. Â¡SÃ© el primero en comentar!"}):i.map(t=>e.jsxs("div",{className:"comment",children:[e.jsxs("div",{className:"comment-header",children:[e.jsx("span",{className:"comment-author",children:t.author_name}),e.jsx("span",{className:"comment-date",children:d(t.created_at)})]}),e.jsx("p",{className:"comment-content",children:t.content})]},t.id))}),e.jsxs("div",{className:"comment-form-wrapper",children:[e.jsx("h3",{children:"Deja tu comentario"}),e.jsxs("form",{className:"comment-form",onSubmit:f,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"author_name",children:"Nombre *"}),e.jsx("input",{type:"text",id:"author_name",value:a.author_name,onChange:t=>c({...a,author_name:t.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"author_email",children:"Email (opcional)"}),e.jsx("input",{type:"email",id:"author_email",value:a.author_email,onChange:t=>c({...a,author_email:t.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"content",children:"Comentario *"}),e.jsx("textarea",{id:"content",rows:"4",value:a.content,onChange:t=>c({...a,content:t.target.value}),required:!0})]}),e.jsx("button",{type:"submit",className:"submit-button",children:"Enviar Comentario"}),m&&e.jsx("div",{className:`submit-status ${m.includes("Error")?"error":"success"}`,children:m})]})]})]})]})}):e.jsx("section",{id:"blog",className:"blog-section",children:e.jsxs("div",{className:"blog-container",children:[e.jsx("h1",{className:"blog-title",children:"Blog"}),h.length===0?e.jsx("p",{className:"no-posts",children:"No hay publicaciones disponibles."}):e.jsx("div",{className:"blog-posts-grid",children:h.map(t=>e.jsxs("article",{className:"blog-post-card",onClick:()=>_(t),children:[e.jsx("h2",{className:"post-card-title",children:t.title}),e.jsxs("div",{className:"post-card-meta",children:[e.jsxs("span",{className:"post-card-author",children:["Por ",t.author]}),e.jsx("span",{className:"post-card-date",children:d(t.created_at)})]}),e.jsx("div",{className:"post-card-excerpt",dangerouslySetInnerHTML:{__html:t.content.substring(0,200)+"..."}}),e.jsxs("div",{className:"post-card-footer",children:[e.jsx("span",{className:"read-more",children:"Leer mÃ¡s â†’"}),e.jsxs("span",{className:"comments-count",children:["ðŸ’¬ ",b[t.id]||0," comentarios"]})]})]},t.id))})]})})}export{k as default};
